from http.server import BaseHTTPRequestHandler, HTTPServer
from http.cookies import SimpleCookie
import base64
import pickle

class MyServer(BaseHTTPRequestHandler):
    def doGET(self):
      cookies = SimpleCookie(self.headers.get('Cookie'))
      if cookies.get('username'):
        username=pickle.loads(base64.b64decode(cookies.get('username').value))
      else:
        username='stranger'
      self.sendresponse(200)
      self.sendheader("Content-type", "text/html")
      self.endheaders()
      self.wfile.write(bytes("<html><head><title>Hello</title></head>", "utf-8"))
      self.wfile.write(bytes("<body>", "utf-8"))
      self.wfile.write(bytes("<h1>Hello %s</h1>" % username, "utf-8"))
      self.wfile.write(bytes("</body></html>", "utf-8"))

if name == "main":
    webServer = HTTPServer(('0.0.0.0', 1337), MyServer)

try:
    webServer.serve_forever()
except KeyboardInterrupt:
    pass

webServer.server_close()
print("Server stopped.")


